---
- name: block [fedora]
  become: true
  ansible.builtin.lineinfile:
    path: "{{ updates }}"
    line: "[fedora]"

- name: Exclude kernel updates from [updates]
  become: yes
  lineinfile:
    path: "{{ updates }}"
    insertafter: "^\\[updates\\]"
    line: "exclude=kernel*"
    state: present

# Has to be last, so it'll write "exclude=kernel" twice
# - name: Exclude kernel updates from [fedora]
#   become: yes
#   lineinfile:
#     path: "{{ updates }}"
#     insertafter: "^[fedora]"
#     line: "exclude=kernel*"
#     state: present
#     backup: yes

- name: Exclude kernel updates from [fedora]
  become: yes
  replace:
    path: "{{ updates }}"
    regexp: "^\\[fedora\\]"
    replace: "[fedora]\nexclude=kernel*"
